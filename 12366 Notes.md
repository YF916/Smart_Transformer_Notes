```
MAIN
build_session()           
  ↓
load_db(问答.json)
  ↓
load_state(state.json)
  ↓
获取 maxPage
  ↓
判断前面是否还有 page
  ├─ 有 → forward 向前跑
  └─ 无 → backfill 失败项 failed_pages/failed_ids/failed_attachments
```


```
FORWARD
maybe_cooldown() ← 如果之前 403 / html-block，先冷却
  ↓
fetch_page(page)
├─ 失败（403 / 502 / 503 / 504 / 其他异常）
    ↓
    记录 failed_pages += page
    更新 state.next_page = page + 1
    跳过这一页，继续向前
└─ 成功
    ↓
    判断 page_set 是否有问答
    ├─ 有 → 遍历 page_set 中的每条 msg
    └─ 无
        ↓
        state.next_page = page + 1
        page += 1
  ↓
直到 page > END_PAGE
  ↓
forward 完成，开始 backfill
```

```
                  ↓
                取 msg_id 判断是否已存在
                  ↓
                ┌─ 是 → skip
                └─ 否
                  ↓
                fetch_detail_html(msg_id)
                  ↓
                parse_detail(html)
                  ↓
                ┌─ 失败
                    ↓
                  记录 failed_ids += msg_id
                  跳过这一条问答，继续向前
                └─ 成功
                    ↓
                  下载附件
                    ↓
                  获取问答 record
                    ↓
                  upsert_record(db, record)
                  更新 count += 1 & max_question_length & max_question_id

```
